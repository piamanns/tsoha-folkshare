{% extends "layout.html" %}
{% block title %}{{ tune.name }}{% endblock %}
{% block content %}
<script>
  var script = document.createElement('script');
  script.onload = function(event) {
    ABCJS.renderAbc("notation", "{{ tune.notation }}");  
  }
  script.defer = true;
  script.src = "{{url_for('static', filename='abcjs-basic-min.js')}}";
  document.body.append(script);
</script>

<h2>{{ tune.name }}</h2>

{% if session.user_id == tune.creator_id or session.user_role == 2 %}
  <form action="/delete_tune/{{ tune.id }}" method="post">
    <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
    <button>Poista kappale</button>
  </form>
{% endif %}

<p>Lisääjä <strong>{{ tune.username }}</strong> ({{ tune.created.strftime("%d.%m.%Y") }}{% if tune.updated %}, muokattu {{ tune.updated.strftime("%d.%m.%Y") }}{% endif %})</p>

<div id="notation">
  <p>Nuotti latautuu</p>
</div>

{% if categories %}
  <p><strong>Kappale on liitetty kategorioihin:</strong></p>
  {% for category in categories %}
    <a href="/category/{{ category.id }}">{{ category.name }}</a> |
  {% endfor %}
{% endif %}

{% if session.user_id == tune.creator_id or session.user_role == 2 %}
  <form action="/update_tune/{{ tune.id }}" method="GET" style="margin-top: 1em">
    <button>Muokkaa kappaletta</button>
  </form>
{% endif %}

{% endblock %}
